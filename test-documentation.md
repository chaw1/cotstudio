# COT Studio MVP ç³»ç»Ÿé›†æˆæµ‹è¯•æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº† COT Studio MVP çš„å®Œæ•´æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬ç«¯åˆ°ç«¯æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•å’Œè´Ÿè½½æµ‹è¯•çš„å®æ–½æ–¹æ¡ˆã€‚

## æµ‹è¯•æ¶æ„

### æµ‹è¯•åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           E2E Tests                 â”‚  â† ç”¨æˆ·å®Œæ•´æµç¨‹æµ‹è¯•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Integration Tests            â”‚  â† æœåŠ¡é—´é›†æˆæµ‹è¯•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Unit Tests                 â”‚  â† å•å…ƒåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Performance Tests             â”‚  â† æ€§èƒ½åŸºå‡†æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

#### 1. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
- **å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•**
  - é¡¹ç›®åˆ›å»º â†’ æ–‡ä»¶ä¸Šä¼  â†’ OCRå¤„ç† â†’ åˆ‡ç‰‡ç”Ÿæˆ â†’ CoTæ ‡æ³¨ â†’ å¯¼å‡º
  - çŸ¥è¯†å›¾è°±æŠ½å– â†’ å¯è§†åŒ– â†’ æŸ¥è¯¢è¿‡æ»¤
  - æ•°æ®å¯¼å…¥å¯¼å‡ºå®Œæ•´æµç¨‹

- **ç”¨æˆ·ç•Œé¢äº¤äº’æµ‹è¯•**
  - æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ 
  - CoTå€™é€‰ç­”æ¡ˆæ’åº
  - çŸ¥è¯†å›¾è°±èŠ‚ç‚¹äº¤äº’
  - å®æ—¶è¿›åº¦æ›´æ–°

#### 2. é›†æˆæµ‹è¯• (Integration Tests)
- **APIé›†æˆæµ‹è¯•**
  - é¡¹ç›®ç®¡ç†APIå®Œæ•´æµç¨‹
  - æ–‡ä»¶å¤„ç†æœåŠ¡é›†æˆ
  - OCRæœåŠ¡é›†æˆ
  - LLMæœåŠ¡é›†æˆ
  - çŸ¥è¯†å›¾è°±æœåŠ¡é›†æˆ

- **æ•°æ®åº“é›†æˆæµ‹è¯•**
  - PostgreSQLæ•°æ®ä¸€è‡´æ€§
  - Neo4jå›¾æ•°æ®åº“æ“ä½œ
  - è·¨æ•°æ®åº“äº‹åŠ¡å¤„ç†

- **å¤–éƒ¨æœåŠ¡é›†æˆæµ‹è¯•**
  - MinIOå¯¹è±¡å­˜å‚¨
  - Redisç¼“å­˜æœåŠ¡
  - Celeryå¼‚æ­¥ä»»åŠ¡

#### 3. æ€§èƒ½æµ‹è¯• (Performance Tests)
- **è´Ÿè½½æµ‹è¯•**
  - å¹¶å‘æ–‡ä»¶ä¸Šä¼  (10+ æ–‡ä»¶)
  - å¹¶å‘CoTç”Ÿæˆ (5+ è¯·æ±‚)
  - å¤§é‡æ•°æ®æŸ¥è¯¢ (1000+ è®°å½•)

- **å‹åŠ›æµ‹è¯•**
  - å†…å­˜ä½¿ç”¨ç›‘æ§
  - CPUä½¿ç”¨ç‡æµ‹è¯•
  - æ•°æ®åº“è¿æ¥æ± æµ‹è¯•

- **åŸºå‡†æµ‹è¯•**
  - APIå“åº”æ—¶é—´åˆ†å¸ƒ
  - æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
  - æ–‡ä»¶å¤„ç†é€Ÿåº¦

## æµ‹è¯•å®æ–½

### åç«¯æµ‹è¯•

#### ç›®å½•ç»“æ„
```
backend/tests/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ conftest.py                    # pytesté…ç½®
â”œâ”€â”€ test_*.py                      # å•å…ƒæµ‹è¯•
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_complete_workflow.py  # å®Œæ•´æµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ test_knowledge_graph_integration.py
â”œâ”€â”€ performance/                   # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_load_performance.py
â”œâ”€â”€ test_runner.py                 # æµ‹è¯•è¿è¡Œå™¨
â””â”€â”€ benchmark.py                   # æ€§èƒ½åŸºå‡†æµ‹è¯•
```

#### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests/test_runner.py

# è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
python tests/test_runner.py unit
python tests/test_runner.py integration
python tests/test_runner.py performance

# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
python tests/benchmark.py

# ä½¿ç”¨pytestç›´æ¥è¿è¡Œ
pytest tests/ -v
pytest tests/integration/ -v --tb=short
pytest tests/performance/ -v -s
```

### å‰ç«¯æµ‹è¯•

#### ç›®å½•ç»“æ„
```
frontend/src/test/
â”œâ”€â”€ setup.ts                      # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ e2e/                          # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.ts
â”‚   â””â”€â”€ complete-workflow.test.tsx
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ knowledge-graph.test.tsx
â””â”€â”€ utils/                        # æµ‹è¯•å·¥å…·
    â””â”€â”€ test-helpers.ts
```

#### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm run test -- complete-workflow.test.tsx

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch
```

## æµ‹è¯•ç”¨ä¾‹è¯¦è§£

### 1. å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•

#### æµ‹è¯•åœºæ™¯ï¼šæ–‡ä»¶ä¸Šä¼ åˆ°CoTç”Ÿæˆ
```typescript
it('should complete full project creation to CoT annotation workflow', async () => {
  // 1. åˆ›å»ºé¡¹ç›®
  // 2. ä¸Šä¼ æ–‡ä»¶
  // 3. è§¦å‘OCRå¤„ç†
  // 4. è·å–åˆ‡ç‰‡
  // 5. ç”ŸæˆCoTé—®é¢˜å’Œç­”æ¡ˆ
  // 6. ä¿å­˜æ ‡æ³¨æ•°æ®
  // 7. éªŒè¯é¡¹ç›®ç»Ÿè®¡
});
```

#### æµ‹è¯•æ•°æ®
- æµ‹è¯•æ–‡ä»¶ï¼šåŒ…å«ä¸­æ–‡AIç›¸å…³å†…å®¹çš„æ–‡æœ¬æ–‡ä»¶
- é¢„æœŸåˆ‡ç‰‡ï¼šæŒ‰æ®µè½è‡ªåŠ¨åˆ†å‰²
- CoTç”Ÿæˆï¼š3-5ä¸ªå€™é€‰ç­”æ¡ˆ
- æ ‡æ³¨æ•°æ®ï¼šè¯„åˆ†ã€æ’åºã€chosenæ ‡è®°

### 2. çŸ¥è¯†å›¾è°±é›†æˆæµ‹è¯•

#### æµ‹è¯•åœºæ™¯ï¼šKGæŠ½å–å’Œå¯è§†åŒ–
```python
def test_entity_extraction_and_storage(self, client, db_session, neo4j_session):
    # 1. åˆ›å»ºåŒ…å«ä¸°å¯Œå®ä½“çš„CoTæ•°æ®
    # 2. è§¦å‘çŸ¥è¯†å›¾è°±æŠ½å–
    # 3. éªŒè¯å®ä½“æŠ½å–ç»“æœ
    # 4. éªŒè¯Neo4jä¸­çš„æ•°æ®
```

#### éªŒè¯ç‚¹
- å®ä½“æŠ½å–å‡†ç¡®æ€§
- å…³ç³»è¯†åˆ«æ­£ç¡®æ€§
- Neo4jæ•°æ®ä¸€è‡´æ€§
- å¯è§†åŒ–æ•°æ®æ ¼å¼

### 3. æ€§èƒ½è´Ÿè½½æµ‹è¯•

#### å¹¶å‘æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
```python
def test_concurrent_file_uploads(self, client, db_session):
    # å¹¶å‘ä¸Šä¼ 10ä¸ªæ–‡ä»¶
    # éªŒè¯ï¼š
    # - æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
    # - å¹³å‡ä¸Šä¼ æ—¶é—´ < 5ç§’
    # - æœ€å¤§ä¸Šä¼ æ—¶é—´ < 10ç§’
```

#### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**ï¼šP95 < 2ç§’ï¼ŒP99 < 5ç§’
- **ååé‡**ï¼šæ–‡ä»¶ä¸Šä¼  > 2 files/s
- **å†…å­˜ä½¿ç”¨**ï¼šå¢é•¿ < 500MB (100æ¬¡æ“ä½œ)
- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒ10ä¸ªå¹¶å‘è¯·æ±‚

## é”™è¯¯å¤„ç†æµ‹è¯•

### 1. æ–‡ä»¶ä¸Šä¼ é”™è¯¯
- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- æ–‡ä»¶å¤§å°è¶…é™
- å­˜å‚¨æœåŠ¡ä¸å¯ç”¨

### 2. OCRå¤„ç†é”™è¯¯
- OCRæœåŠ¡è¶…æ—¶
- æ–‡ä»¶æ ¼å¼ä¸å…¼å®¹
- å¤„ç†ç»“æœä¸ºç©º

### 3. LLMæœåŠ¡é”™è¯¯
- APIè°ƒç”¨è¶…æ—¶
- é…é¢ä¸è¶³
- æœåŠ¡ä¸å¯ç”¨

### 4. æ•°æ®åº“é”™è¯¯
- è¿æ¥è¶…æ—¶
- çº¦æŸè¿å
- äº‹åŠ¡å›æ»š

## æµ‹è¯•æ•°æ®ç®¡ç†

### æµ‹è¯•æ•°æ®ç”Ÿæˆ
```python
# é¡¹ç›®æµ‹è¯•æ•°æ®
def create_test_project():
    return Project(
        name="Test Project",
        owner="test_user",
        description="Test project for unit tests",
        tags=["test"],
        project_type=ProjectType.STANDARD
    )

# æ–‡ä»¶æµ‹è¯•æ•°æ®
def create_test_file():
    content = "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯..."
    return tempfile.NamedTemporaryFile(
        mode='w', suffix='.txt', 
        delete=False, encoding='utf-8'
    )
```

### æµ‹è¯•æ•°æ®æ¸…ç†
- æ¯ä¸ªæµ‹è¯•å‰æ¸…ç†æ•°æ®åº“
- åˆ é™¤ä¸´æ—¶æ–‡ä»¶
- é‡ç½®Redisç¼“å­˜
- æ¸…ç†Neo4jæµ‹è¯•æ•°æ®

## æŒç»­é›†æˆ

### GitHub Actions é…ç½®
```yaml
name: Test Suite
on: [push, pull_request]

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      neo4j:
        image: neo4j:5.0
        env:
          NEO4J_AUTH: neo4j/password
    
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      - name: Run tests
        run: python tests/test_runner.py
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3

  frontend-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: |
          cd frontend
          npm ci
      
      - name: Run tests
        run: |
          cd frontend
          npm run test:coverage
```

## æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡è¦æ±‚
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**ï¼šâ‰¥ 80%
- **APIæµ‹è¯•è¦†ç›–ç‡**ï¼šâ‰¥ 90%
- **å…³é”®ä¸šåŠ¡æµç¨‹**ï¼š100%

### æŠ¥å‘Šæ ¼å¼
- HTMLè¦†ç›–ç‡æŠ¥å‘Š
- JUnit XMLæµ‹è¯•ç»“æœ
- JSONæ€§èƒ½åŸºå‡†æŠ¥å‘Š
- Markdownæµ‹è¯•æ‘˜è¦

### æŠ¥å‘Šç¤ºä¾‹
```
ğŸ“Š æµ‹è¯•æ‰§è¡Œæ‘˜è¦
==========================================
â±ï¸  æ€»æ‰§è¡Œæ—¶é—´: 45.23ç§’
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡: æ˜¯

ğŸ“‹ æµ‹è¯•å¥—ä»¶ç»“æœ:
  unit_tests: âœ… é€šè¿‡
  integration_tests: âœ… é€šè¿‡
  performance_tests: âœ… é€šè¿‡
  frontend_tests: âœ… é€šè¿‡

ğŸ“ˆ ä»£ç è¦†ç›–ç‡: 85.2%

âš¡ æ€§èƒ½æŒ‡æ ‡:
  å†…å­˜ä½¿ç”¨å˜åŒ–: 125.3MB
  å¹³å‡å“åº”æ—¶é—´: 0.245s
  æ€§èƒ½ç­‰çº§: A
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æµ‹è¯•æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
docker-compose ps postgres

# é‡å¯æ•°æ®åº“æœåŠ¡
docker-compose restart postgres
```

#### 2. Neo4jè¿æ¥è¶…æ—¶
```bash
# æ£€æŸ¥Neo4jçŠ¶æ€
docker-compose logs neo4j

# å¢åŠ è¿æ¥è¶…æ—¶æ—¶é—´
export NEO4J_TIMEOUT=30
```

#### 3. å‰ç«¯æµ‹è¯•å¤±è´¥
```bash
# æ¸…ç†node_modules
rm -rf frontend/node_modules
cd frontend && npm install

# æ›´æ–°æµ‹è¯•å¿«ç…§
npm run test -- --update-snapshots
```

#### 4. æ€§èƒ½æµ‹è¯•ä¸ç¨³å®š
- ç¡®ä¿æµ‹è¯•ç¯å¢ƒèµ„æºå……è¶³
- å…³é—­å…¶ä»–å ç”¨èµ„æºçš„ç¨‹åº
- å¢åŠ æµ‹è¯•é‡è¯•æ¬¡æ•°
- è°ƒæ•´æ€§èƒ½é˜ˆå€¼

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç¼–å†™åŸåˆ™
- **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- **å¯é‡å¤æ€§**ï¼šå¤šæ¬¡è¿è¡Œç»“æœä¸€è‡´
- **å¿«é€Ÿæ€§**ï¼šå•å…ƒæµ‹è¯• < 1ç§’
- **æ¸…æ™°æ€§**ï¼šæµ‹è¯•æ„å›¾æ˜ç¡®

### 2. æµ‹è¯•æ•°æ®åŸåˆ™
- ä½¿ç”¨å·¥å‚æ¨¡å¼ç”Ÿæˆæµ‹è¯•æ•°æ®
- é¿å…ç¡¬ç¼–ç æµ‹è¯•æ•°æ®
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹æ•°æ®
- æµ‹è¯•ååŠæ—¶æ¸…ç†æ•°æ®

### 3. æ€§èƒ½æµ‹è¯•åŸåˆ™
- é¢„çƒ­ç³»ç»Ÿåå†æµ‹é‡
- å¤šæ¬¡æµ‹é‡å–å¹³å‡å€¼
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
- è®¾ç½®åˆç†çš„æ€§èƒ½é˜ˆå€¼

### 4. é”™è¯¯å¤„ç†åŸåˆ™
- æµ‹è¯•æ‰€æœ‰é”™è¯¯è·¯å¾„
- éªŒè¯é”™è¯¯æ¶ˆæ¯å‡†ç¡®æ€§
- ç¡®ä¿ç³»ç»Ÿä¼˜é›…é™çº§
- æä¾›é‡è¯•æœºåˆ¶

## æ€»ç»“

æœ¬æµ‹è¯•å¥—ä»¶æä¾›äº† COT Studio MVP çš„å…¨é¢æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬ï¼š

1. **å®Œæ•´ä¸šåŠ¡æµç¨‹éªŒè¯**ï¼šç¡®ä¿ç«¯åˆ°ç«¯åŠŸèƒ½æ­£å¸¸
2. **ç³»ç»Ÿé›†æˆéªŒè¯**ï¼šç¡®ä¿å„æœåŠ¡ååŒå·¥ä½œ
3. **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šç¡®ä¿ç³»ç»Ÿæ€§èƒ½è¾¾æ ‡
4. **é”™è¯¯å¤„ç†éªŒè¯**ï¼šç¡®ä¿ç³»ç»Ÿå¥å£®æ€§

é€šè¿‡æ‰§è¡Œè¿™äº›æµ‹è¯•ï¼Œå¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„è´¨é‡ã€æ€§èƒ½å’Œå¯é æ€§ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æä¾›ä¿¡å¿ƒä¿éšœã€‚