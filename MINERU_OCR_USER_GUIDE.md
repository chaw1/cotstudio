# MinerU OCR使用指南

## 概述

MinerU是一个高性能OCR引擎，支持复杂文档结构识别，特别适用于PDF、图像和扫描文档。本系统已成功集成MinerU 2.5引擎，并配置了GPU加速。

## 环境信息

- **MinerU版本**: 2.5.4
- **GPU**: NVIDIA RTX 5090 (32GB VRAM)
- **CUDA版本**: 13.0
- **后端**: PyTorch 2.8.0+cu129
- **服务地址**: http://mineru:8001 (容器内部)

## 使用步骤

### 1. 上传文档

1. 登录系统后进入项目详情页面
2. 点击"上传文件"按钮
3. 选择要处理的文档(支持PDF、图片等格式)
4. 等待文件上传完成

### 2. 启动OCR处理

1. 在项目详情页面点击"OCR处理"标签
2. 在文件列表中找到您要处理的文件
3. 点击文件旁边的"开始OCR"按钮
4. 在弹出的引擎选择对话框中:
   - 选择 **MinerU** 作为OCR引擎
   - 点击"开始处理"按钮

### 3. 监控处理进度

处理开始后,您可以:

- 查看实时进度百分比
- 查看处理日志信息
- 等待处理完成通知

### 4. 查看处理结果

处理完成后:

1. 切换到"切片管理"标签
2. 查看生成的文档切片
3. 每个切片包含:
   - 提取的文本内容
   - 页码信息
   - 切片类型(段落/表格/图像)
   - 创建时间

## 支持的文件格式

✅ **支持**:
- PDF文档(.pdf)
- 图像文件(.jpg, .jpeg, .png, .bmp)
- 扫描文档
- 多页PDF文档

❌ **不支持**:
- 纯文本文件(.txt) - 请使用Fallback引擎
- 加密PDF文档
- 损坏的文件

## OCR引擎对比

| 特性 | MinerU | PaddleOCR | Fallback |
|------|--------|-----------|----------|
| 中文识别 | ✅ 优秀 | ✅ 良好 | ❌ 不支持 |
| 英文识别 | ✅ 优秀 | ✅ 良好 | ✅ 基础 |
| 表格识别 | ✅ 支持 | ⚠️ 有限 | ❌ 不支持 |
| 图像识别 | ✅ 支持 | ✅ 支持 | ❌ 不支持 |
| 复杂布局 | ✅ 优秀 | ⚠️ 一般 | ❌ 不支持 |
| GPU加速 | ✅ 支持 | ✅ 支持 | ❌ 不需要 |
| 处理速度 | ⚡ 快速 | ⚡ 中等 | ⚡⚡ 极快 |
| 准确率 | 📈 高 | 📈 中高 | 📈 低 |

## 推荐使用场景

### 使用MinerU的场景

✅ **强烈推荐**:
- 扫描文档OCR
- 包含表格的PDF文档
- 复杂排版的文档
- 多列布局文档
- 包含图像和文字混排的文档
- 需要高准确率的场景

### 使用其他引擎的场景

**PaddleOCR**:
- 简单的文本识别任务
- 不包含复杂表格的文档
- 资源受限环境

**Fallback**:
- 纯文本文件提取
- 已经是文本格式的PDF
- 不需要OCR的场景

## 性能参数

### 处理速度

- **单页PDF**: 约2-5秒
- **10页PDF**: 约20-50秒
- **100页PDF**: 约3-8分钟

*注: 实际速度取决于文档复杂度和GPU负载*

### GPU使用

- **显存占用**: 4-8GB (取决于文档大小)
- **GPU利用率**: 30-80%
- **温度**: 通常保持在40-60°C

### 质量设置

MinerU默认使用以下配置:

```python
{
    'backend': 'pipeline',      # 处理后端
    'device': 'cuda',            # 使用GPU
    'batch_size': 8              # 批处理大小
}
```

## 常见问题

### Q1: OCR处理失败怎么办?

**A**: 检查以下几点:

1. 文件格式是否支持
2. 文件是否损坏
3. 文件大小是否过大(>100MB)
4. MinerU服务是否运行正常

**验证MinerU服务**:

```bash
curl http://localhost:8001/health
```

期望响应:

```json
{
  "status": "healthy",
  "mineru_ready": true,
  "gpu_available": true,
  "gpu_count": 1
}
```

### Q2: 为什么处理速度很慢?

**A**: 可能原因:

1. **文档很大**: 100页以上的文档需要更多时间
2. **GPU繁忙**: 其他任务正在使用GPU
3. **复杂布局**: 包含大量表格和图像的文档需要更多处理时间

**优化建议**:
- 将大文档拆分成小文档处理
- 在系统负载较低时处理
- 检查GPU状态(在系统状态仪表板中)

### Q3: OCR结果不准确怎么办?

**A**: 提升准确率的方法:

1. **提高图像质量**: 使用高分辨率扫描(至少300 DPI)
2. **文档预处理**: 
   - 去除噪点
   - 校正倾斜
   - 增强对比度
3. **选择合适的引擎**: 复杂文档使用MinerU,简单文档可以使用PaddleOCR

### Q4: 支持哪些语言?

**A**: MinerU支持:

- ✅ 中文(简体/繁体)
- ✅ 英文
- ✅ 数字和符号
- ⚠️ 其他语言支持有限,准确率可能较低

### Q5: 可以批量处理吗?

**A**: 当前版本支持:

- ✅ 单个文件处理
- ✅ 多页文档一次性处理
- ⚠️ 批量多文件处理功能开发中

**临时方案**: 可以多次点击不同文件的"开始OCR"按钮,系统会按顺序处理。

## 故障排查

### 检查服务状态

```bash
# 检查所有服务
docker-compose ps

# 检查MinerU服务
docker logs cotstudio-mineru-1 --tail 50

# 检查后端服务
docker logs cotstudio-backend-1 --tail 50

# 检查Celery任务队列
docker logs cotstudio-celery-1 --tail 50
```

### 重启服务

如果遇到问题,可以尝试重启相关服务:

```bash
# 重启MinerU服务
docker-compose restart mineru

# 重启后端服务
docker-compose restart backend

# 重启Celery服务
docker-compose restart celery

# 重启所有服务
docker-compose restart
```

### 查看GPU状态

在系统仪表板首页可以查看:

- GPU型号和数量
- 显存使用情况
- GPU利用率和温度
- CUDA版本

或通过命令行:

```bash
# 在MinerU容器中查看
docker exec cotstudio-mineru-1 nvidia-smi

# 在后端容器中查看(已配置GPU访问)
docker exec cotstudio-backend-1 nvidia-smi
```

## 技术支持

如果遇到其他问题:

1. 查看 [OCR MinerU修复报告](./OCR_MINERU_FIX_REPORT.md)
2. 查看 [MinerU GPU安装文档](./MINERU_GPU_INSTALLATION_SUCCESS.md)
3. 查看 [项目指南](./PROJECT_GUIDE.md)
4. 检查Docker日志获取详细错误信息

## 更新日志

### 2025-10-16

- ✅ 成功集成MinerU 2.5.4引擎
- ✅ 配置GPU加速(NVIDIA RTX 5090)
- ✅ 修复422错误,支持MinerU引擎选择
- ✅ 优化Docker容器网络配置
- ✅ 添加GPU状态监控到系统仪表板

### 未来计划

- 📋 批量文件OCR处理
- 📋 OCR结果质量评分
- 📋 多语言支持增强
- 📋 自定义OCR参数配置
- 📋 OCR结果导出功能

## 最佳实践

1. **文档准备**:
   - 使用高质量扫描件(300+ DPI)
   - 确保文档清晰,无严重模糊
   - 避免过度倾斜或扭曲

2. **引擎选择**:
   - 复杂文档 → MinerU
   - 简单文档 → PaddleOCR
   - 纯文本 → Fallback

3. **任务管理**:
   - 避免同时处理大量文件
   - 大文档可以分批处理
   - 定期检查任务队列状态

4. **结果验证**:
   - 处理完成后检查切片质量
   - 对关键内容进行人工审核
   - 必要时重新处理低质量结果

---

**系统版本**: v1.0.0  
**文档更新日期**: 2025-10-16  
**GPU环境**: NVIDIA RTX 5090, 32GB VRAM, CUDA 13.0
